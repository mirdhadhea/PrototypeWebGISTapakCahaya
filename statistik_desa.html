<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>GeoVillage+</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet">

<style>
/* =================== THEME TOKENS =================== */
:root{
  --bg:#7ba6ac;--ink:#ffe9c4;--teal:#ff7e6d;--teal-2:#ff7e6d;--white:#fff;
  --muted:color-mix(in srgb,var(--ink)70%,var(--bg)30%);
  --menu-edge-gap:14px;--header-xpad:8px;--menu-gap:42px;--logo-size:50px;--header-py:30px;--brand-left-gap:16px;
  --footer-bg:#1e365a;--footer-max:min(1100px,92%);--footer-accent:#fff;--footer-text:#fff;
}
*{box-sizing:border-box}
body{margin:0;font-family:"Outfit",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;color:var(--ink);background:var(--bg)}
.container{width:min(1100px,92%);margin-inline:auto}

/* =================== HEADER (konsisten) =================== */
.topbar{background:#1e365a;color:var(--ink)}
.topbar .container{width:100%;margin:0;padding:0 var(--header-xpad)}
.nav{display:flex;align-items:center;gap:10px;padding-block:var(--header-py);min-height:calc(var(--logo-size) + var(--header-py))}
.brand{display:flex;align-items:center;gap:8px;flex:0 0 auto;margin-left:var(--brand-left-gap)}
.logo{width:var(--logo-size);height:var(--logo-size);display:block}
.logo img{width:100%;height:100%;object-fit:contain;display:block}
.brand-text{line-height:1.05;font-weight:700;font-size:20px;color:var(--footer-accent)!important}
.menu{margin-left:auto;display:flex;align-items:center;justify-content:flex-end;gap:var(--menu-gap);flex-wrap:nowrap;padding-inline-end:var(--menu-edge-gap)}
.menu a{text-decoration:none;font-weight:700;padding:8px 0;font-size:16px;color:var(--footer-accent)!important}
.menu a:hover{color:#fff!important}

/* =================== DASHBOARD CARDS =================== */
.dash{max-width:min(1200px,92%);margin:48px auto}
.dash + .dash{margin-top:22px}
.dash-head h2{color:#1e365a;margin:0 0 24px;font-size:1.9rem;font-weight:900;text-align:center}
.dash-grid{display:grid;grid-template-columns:1.3fr .7fr;gap:22px}
.card{background:#fff;border-radius:18px;box-shadow:0 10px 26px rgba(0,0,0,.05);border:2px solid #3E6778;overflow:hidden}
.card-head{padding:16px 18px 0}
.card-head h3{margin:0;color:#1e365a;font-size:1.05rem;font-weight:800}

/* KPI */
.kpi{display:flex;align-items:center;gap:18px;padding:26px 28px}
.kpi .kpi-icon{width:60px;height:60px;border-radius:14px;display:grid;place-items:center;background:#E6F4EF;border:1px solid #CBE7DF;color:#0E8C6E;box-shadow:0 2px 0 rgba(14,140,110,.08) inset}
.kpi .kpi-body{display:flex;flex-direction:column;line-height:1}
.kpi .kpi-title{margin:0 0 8px;font-weight:800;font-size:1.05rem;letter-spacing:.2px;color:#567181}
.kpi .kpi-value{margin:0;font-weight:900;font-size:2.8rem;letter-spacing:.3px;color:#0F2030}
.kpi .kpi-value::after{content:" KK";margin-left:.4rem;font-weight:800;font-size:.9rem;color:#7A8B98}

/* Donut wrapper & center label */
.chart-wrap.small{position:relative;width:210px;height:210px;margin:16px auto 10px;display:flex;align-items:center;justify-content:center}
.chart-wrap.small canvas{width:100%!important;height:100%!important}
.center-label{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;pointer-events:none}
.center-total{font-size:.78rem;font-weight:700;color:#6b7a89}
.center-number{font-size:1.4rem;font-weight:800;color:#0f2030}
.center-sub{font-size:.78rem;font-weight:700;color:#6b7a89}

/* Legends & tooltip */
.pro-legend{display:flex;flex-wrap:wrap;justify-content:center;gap:18px;font-weight:700;color:#1e365a;margin:20px 0 12px}
.pro-legend .dot{display:inline-block;width:14px;height:14px;border-radius:4px;margin-right:6px;vertical-align:middle;border:1px solid rgba(0,0,0,.08)}
.pro-legend .male{background:#8DA6C6}
.pro-legend .female{background:#FF7E6D}
.click-info{text-align:center;font-weight:700;color:#0f2030;font-size:.9rem;margin-bottom:12px;min-height:1.2em}

.chartjs-tooltip{position:absolute;transform:translate(-50%,-120%);background:#0f2030;color:#fff;padding:10px 12px;border-radius:12px;box-shadow:0 8px 18px rgba(0,0,0,.35);z-index:30;pointer-events:none;min-width:220px;font-family:"Outfit",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif}
.chartjs-tooltip::after{content:"";position:absolute;left:50%;bottom:-8px;transform:translateX(-50%);border-width:8px 8px 0 8px;border-style:solid;border-color:#0f2030 transparent transparent transparent}
.chartjs-tooltip .tt-row{display:flex;align-items:center;gap:8px;font-weight:800;font-size:13px;line-height:1.2}
.chartjs-tooltip .tt-dot{width:14px;height:14px;border-radius:3px;border:2px solid rgba(255,255,255,.45);flex:0 0 auto}

/* Paired bars & other canvases */
.card.bar-paired .paired-inner{padding:14px 18px 18px;padding-right:44px}
#pairedBars{display:block;width:100%!important;height:clamp(320px,44vh,560px)!important}
.card.bar-age .age-inner{padding:14px 18px 18px}
#ageBars{display:block;width:100%!important;height:clamp(300px,42vh,520px)!important}
.card.bar-edu .edu-inner{padding:14px 18px 18px}
#eduBars{display:block;width:100%!important;height:clamp(340px,48vh,600px)!important}

.dash-grid.two-cols{max-width:min(1200px,92%);margin:0 auto;display:grid;grid-template-columns:1fr 1fr;gap:22px;align-items:stretch}
.dash-grid.two-cols .card:nth-child(2){display:flex;flex-direction:column}
.dash-grid.two-cols .card:nth-child(2) > :not(.card-head){flex:1 1 auto;display:flex;align-items:center;justify-content:center;min-height:0;padding:8px 18px 22px}
.dash-grid.two-cols .card:nth-child(2) .chart-wrap.small{width:420px!important;height:420px!important;margin:0 auto!important}
.dash-grid.two-cols .chart-wrap.small .center-label .center-total{font-size:1.05rem;font-weight:800;letter-spacing:.2px;color:#6b7a89;line-height:1.05}
.dash-grid.two-cols .chart-wrap.small .center-label .center-number{font-size:3.2rem;font-weight:900;color:#0f2030;line-height:1;margin:2px 0;text-shadow:0 1px 0 rgba(255,255,255,.4)}
.dash-grid.two-cols .chart-wrap.small .center-label .center-sub{font-size:1.05rem;font-weight:800;color:#6b7a89;line-height:1.05}

/* =================== FOOTER (konsisten) =================== */
.footer-wave{height:84px;line-height:0;margin-bottom:-46px;pointer-events:none}
.footer-wave svg{width:100%;height:100%;display:block}
.footer-wave path{fill:var(--bg)}

.site-footer{position:relative;overflow:hidden;background:#1e365a;color:#e4f1ef;padding-top:22px;margin-top:-1px}
.footer-grid{position:relative;z-index:1;width:var(--footer-max);margin-inline:auto;display:grid;grid-template-columns:1.2fr 1.05fr 1fr;gap:clamp(20px,3vw,48px);align-items:start}
.footer-brand{font-weight:800;font-size:clamp(28px,3.6vw,32px);line-height:1.08;margin:0 0 .75rem;color:var(--footer-accent);letter-spacing:.2px}
.footer-addr{margin:.35rem 0 0;color:var(--footer-text);font-size:clamp(14px,1.6vw,18px);line-height:1.65;max-width:38ch}
.footer-contact h4{margin:0 0 .65rem;color:var(--footer-accent);font-size:clamp(18px,2vw,22px)}
.contact-list{list-style:none;padding:0;margin:0 0 .85rem;display:grid;gap:.55rem}
.contact-list li{display:flex;align-items:center;gap:.65rem}
.contact-list .ic{inline-size:28px;block-size:28px;display:grid;place-items:center;flex:0 0 auto}
.contact-list .ic svg{stroke:#fff!important;fill:none!important;width:22px;height:22px;color:#fff!important}
.contact-list a{color:#fefefe;text-decoration:none;font-weight:600}
.contact-list a:hover{text-decoration:underline}
.footer-quote{color:var(--footer-text);font-style:italic;font-size:clamp(15px,1.8vw,20px);line-height:1.65;max-width:42ch}
.socials{display:flex;gap:.7rem;margin-top:.4rem}
.socials .soc{width:40px;height:40px;border-radius:12px;border:2px solid rgba(255,255,255,.45);display:grid;place-items:center;color:#fff;transition:transform .18s ease,border-color .18s ease,background-color .18s ease}
.socials .soc svg{width:20px;height:20px}
.socials .soc:hover{background:rgba(255,255,255,.12);border-color:#fff;transform:translateY(-2px)}
.footer-credits{border-top:1px solid rgba(255,255,255,.12);padding:10px 0 18px}
.footer-credits small{display:block;width:var(--footer-max);margin-inline:auto;text-align:center;letter-spacing:.2px;color:#fff}

/* =================== RESPONSIF =================== */
@media (max-width:960px){
  .dash-grid{grid-template-columns:1fr}
  .dash-grid.two-cols{grid-template-columns:1fr}
  .dash-grid.two-cols .card:nth-child(2) .chart-wrap.small{width:300px!important;height:300px!important}
}
</style>
</head>
<body>

<!-- =================== HEADER =================== -->
<header class="topbar">
  <div class="container nav">
    <div class="brand">
      <span class="logo"><img src="./static/img/busel.png" alt="Busel"></span>
      <div class="brand-text"><strong>Kabupaten</strong><br>Buton<br>Selatan</div>
    </div>
    <nav class="menu">
      <a href="./index.html">Beranda</a>
      <a href="./warisan_abadi.html">Warisan Abadi</a>
      <a href="./pelukan_alam.html">Pelukan Alam</a>
      <a href="./tangan_berkarya.html">Tangan Berkarya</a>
      <a href="./statistik_desa.html" class="cta">Statistik Desa</a>
      <a href="./sapa_kami.html">Sapa Kami</a>
    </nav>
  </div>
</header>

<!-- =================== DASHBOARD =================== -->
<section class="dash">
  <header class="dash-head"><h2>Profil Demografi Penduduk Desa Gaya Baru</h2></header>
  <div class="dash-grid">
    <!-- Donut: Jenis Kelamin -->
    <article class="card card-chart">
      <div class="card-head"><h3>Jenis Kelamin</h3></div>
      <div class="chart-wrap small">
        <canvas id="genderDonut"></canvas>
        <div class="center-label">
          <div class="center-total">Total</div>
          <div class="center-number">1.678</div>
          <div class="center-sub">Jiwa</div>
        </div>
      </div>
      <div class="pro-legend">
        <span><i class="dot male"></i>Laki-laki</span>
        <span><i class="dot female"></i>Perempuan</span>
      </div>
      <div id="clickInfo" class="click-info"></div>
    </article>

    <!-- KPI: KK -->
    <article class="card kpi">
      <div class="kpi-icon home" aria-hidden="true">
        <svg viewBox="0 0 24 24" width="28" height="28" fill="currentColor"><path d="M12 3 2 11h2v9a1 1 0 0 0 1 1h5v-6h4v6h5a1 1 0 0 0 1-1v-9h2Z"/></svg>
      </div>
      <div class="kpi-body">
        <div class="kpi-title">Kepala Keluarga (KK)</div>
        <div class="kpi-value">380</div>
      </div>
    </article>
  </div>
</section>

<!-- Horizontal Bar: Populasi & KK per Dusun -->
<section class="dash">
  <article class="card bar-paired">
    <div class="card-head"><h3>Populasi dan KK per Dusun</h3></div>
    <div class="paired-inner"><canvas id="pairedBars"></canvas></div>
  </article>
</section>

<!-- Bar: Distribusi Umur -->
<section class="dash">
  <article class="card bar-age">
    <div class="card-head"><h3>Distribusi Umur (Jiwa)</h3></div>
    <div class="age-inner"><canvas id="ageBars"></canvas></div>
  </article>
</section>

<!-- Bar: Distribusi Pendidikan -->
<section class="dash">
  <article class="card bar-edu">
    <div class="card-head"><h3>Distribusi Pendidikan (Jiwa)</h3></div>
    <div class="edu-inner"><canvas id="eduBars"></canvas></div>
  </article>
</section>

<!-- Dua Kolom: Pekerjaan & Donut Sektor -->
<div class="dash-grid two-cols">
  <article class="card">
    <div class="card-head"><h3>Mata Pencaharian (Jiwa)</h3></div>
    <div style="padding:14px 18px 18px;"><canvas id="jobsBar" style="width:100%;height:520px"></canvas></div>
  </article>

  <article class="card">
    <div class="card-head"><h3>Ringkasan per Sektor</h3></div>
    <div class="chart-wrap small">
      <canvas id="sectorDonut"></canvas>
      <div class="center-label">
        <div class="center-total">Total</div>
        <div class="center-number" id="donutTotal">446</div>
        <div class="center-sub">Jiwa</div>
      </div>
    </div>
    <div class="pro-legend" id="sectorLegend"></div>
  </article>
</div>

<!-- FOOTER WAVE -->
<svg aria-hidden="true" viewBox="0 0 1440 120" preserveAspectRatio="none" class="footer-wave">
  <path d="M0,80 C200,40 400,120 600,80 C800,40 1000,120 1200,80 C1320,50 1440,100 1440,100 L1440,120 L0,120 Z"></path>
</svg>

<!-- FOOTER -->
<footer class="site-footer">
  <div class="footer-grid">
    <div>
      <div class="footer-brand">Desa<br>Gaya<br>Baru</div>
      <p class="footer-addr">Kecamatan Lapandewa<br>Kabupaten Buton Selatan,<br>Sulawesi Tenggara 93753</p>
    </div>
    <div class="footer-contact">
      <h4>Hubungi Kami</h4>
      <ul class="contact-list">
        <li>
          <span class="ic" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M22 16.9v3a2 2 0 0 1-2.2 2 19.9 19.9 0 0 1-8.6-3.1 19.6 19.6 0 0 1-6-6 19.9 19.9 0 0 1-3.1-8.6A2 2 0 0 1 4.1 2h3a2 2 0 0 1 2 1.7c.1.8.3 1.6.6 2.4a2 2 0 0 1-.5 2.1L8.1 9.9a16 16 0 0 0 6 6l1.7-1.1a2 2 0 0 1 2.1-.5c.8.2 1.6.5 2.4.6A2 2 0 0 1 22 16.9Z" stroke="currentColor" stroke-width="2"/>
            </svg>
          </span>
          <a href="https://wa.me/6281323642950" aria-label="WhatsApp 0813-2364-2950">0813-2364-2950</a>
        </li>
        <li>
          <span class="ic" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="2"/>
              <path d="M3 7.5 12 13 21 7.5" stroke="currentColor" stroke-width="2"/>
            </svg>
          </span>
          <a href="mailto:info@desagayabaru.id">info@desagayabaru.id</a>
        </li>
      </ul>
      <div class="socials">
        <a href="https://www.facebook.com/DesaGayaBaruKecLapandewaKabupatenButonSelatan/" target="_blank" rel="noopener" aria-label="Facebook" class="soc">
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z" stroke="currentColor" stroke-width="2"/></svg>
        </a>
        <a href="https://www.youtube.com/@Waburi_Park/" target="_blank" rel="noopener" aria-label="YouTube" class="soc">
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><rect x="2" y="6" width="20" height="12" rx="3" stroke="currentColor" stroke-width="2"/><path d="M10 9.5 15 12l-5 2.5z" fill="currentColor"/></svg>
        </a>
      </div>
    </div>
    <div><p class="footer-quote">“Di pesisir ini, ombak bercerita, angin berbisik, dan kehidupan berjalan dalam harmoni.”</p></div>
  </div>
  <div class="footer-credits"><small>© <span id="year"></span> Desa Gaya Baru — by Mirdha Dhea Permata</small></div>
</footer>

<!-- =================== SCRIPTS =================== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
<script>
document.getElementById('year').textContent = new Date().getFullYear();

document.addEventListener('DOMContentLoaded', () => {
  const OUTFIT = '"Outfit", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif';
  Chart.defaults.font.family = OUTFIT;

  // Tooltip helper (donut)
  const getOrCreateTooltipEl = (chart) => {
    const parent = chart.canvas.parentNode;
    let el = parent.querySelector('.chartjs-tooltip');
    if(!el){ el = document.createElement('div'); el.className='chartjs-tooltip'; el.style.opacity=0; parent.appendChild(el); }
    return el;
  };
  const externalTooltipDonut = (ctx) => {
    const { chart, tooltip } = ctx, el = getOrCreateTooltipEl(chart);
    if(tooltip.opacity===0){ el.style.opacity=0; return; }
    const dp = tooltip.dataPoints[0], value = dp.raw, total = chart.data.datasets[0].data.reduce((a,b)=>a+b,0);
    const pct = ((value/total)*100).toFixed(1);
    const color = Array.isArray(dp.dataset.backgroundColor) ? dp.dataset.backgroundColor[dp.dataIndex] : dp.dataset.backgroundColor;
    el.innerHTML = `<div class="tt-row"><span class="tt-dot" style="background:${color}"></span><span>${dp.label}: <strong>${value} jiwa</strong> (${pct}%)</span></div>`;
    const { offsetLeft:x, offsetTop:y } = chart.canvas;
    el.style.opacity = 1; el.style.left = (x + tooltip.caretX) + 'px'; el.style.top = (y + tooltip.caretY) + 'px';
  };

  // Donut: Jenis Kelamin
  (() => {
    const ctx = document.getElementById("genderDonut"); if(!ctx) return;
    new Chart(ctx.getContext("2d"), {
      type: "doughnut",
      data: { labels:["Laki-laki","Perempuan"], datasets:[{ data:[896,782], backgroundColor:["#8DA6C6","#FF7E6D"], borderWidth:0 }] },
      options: { responsive:true, maintainAspectRatio:false, cutout:"72%", plugins:{ legend:{display:false}, tooltip:{ enabled:false, external:externalTooltipDonut } } }
    });
  })();

  // Horizontal Bar: Populasi & KK per Dusun
  (() => {
    const el = document.getElementById("pairedBars"); if(!el) return;
    const ctx = el.getContext("2d");
    const createGradient = (c, a, b) => { const g=c.createLinearGradient(0,0,800,0); g.addColorStop(0,a); g.addColorStop(1,b); return g; };
    const gradientPop = createGradient(ctx, "#AFC3DD", "#8DA6C6");
    const gradientKK  = createGradient(ctx, "#FFB8A9", "#FF7E6D");
    new Chart(ctx, {
      type:"bar",
      data:{ labels:["Dusun Lantai Dua","Dusun Jaya","Dusun Lakaliba"],
        datasets:[ {label:"Populasi (Jiwa)", data:[1042,364,256], backgroundColor:gradientPop, borderRadius:8, barThickness:18},
                   {label:"KK",              data:[234, 76, 70],  backgroundColor:gradientKK,  borderRadius:8, barThickness:18} ] },
      options:{
        indexAxis:"y", responsive:true, maintainAspectRatio:false,
        plugins:{ legend:{ display:true, labels:{ usePointStyle:true, pointStyle:"rectRounded", boxWidth:10, font:{ family:OUTFIT, weight:"700" }, color:"#1e365a" } },
                  tooltip:{ backgroundColor:"#1e365a", titleFont:{family:OUTFIT,weight:"800"}, bodyFont:{family:OUTFIT,weight:"600"},
                            callbacks:{ label:(c)=>`${c.dataset.label}: ${c.raw}${c.datasetIndex===1?" KK":" jiwa"}` } } },
        scales:{ x:{ grid:{color:"rgba(0,0,0,.06)"}, ticks:{color:"#1e365a",font:{family:OUTFIT}}, title:{display:true,text:"Jumlah",color:"#1e365a",font:{family:OUTFIT,weight:800}} },
                 y:{ grid:{display:false}, ticks:{color:"#1e365a",font:{family:OUTFIT,weight:800}} } }
      }
    });
  })();

  // Horizontal Bar: Distribusi Umur
  (() => {
    const el = document.getElementById('ageBars'); if(!el) return;
    const ctx = el.getContext('2d');
    const g = ctx.createLinearGradient(0,0,800,0); g.addColorStop(0,'#AFC3DD'); g.addColorStop(1,'#8DA6C6');
    new Chart(ctx, {
      type:'bar',
      data:{ labels:["0–15","15–45","45–54","54–60","> 60"], datasets:[{ label:'Jumlah Jiwa', data:[315,954,145,55,102], backgroundColor:g, borderRadius:8, borderSkipped:false }] },
      options:{
        indexAxis:'y', responsive:true, maintainAspectRatio:false,
        plugins:{ legend:{display:false}, tooltip:{ backgroundColor:'#1e365a', titleFont:{family:OUTFIT,weight:'800'}, bodyFont:{family:OUTFIT,weight:'600'},
                  callbacks:{ title:c=>c[0].label, label:c=>` ${c.raw} jiwa` } } },
        scales:{ x:{ beginAtZero:true, grid:{color:'rgba(0,0,0,.06)'}, ticks:{color:'#1e365a',font:{family:OUTFIT}}, title:{display:true,text:'Jiwa',color:'#1e365a',font:{family:OUTFIT,weight:800}} },
                 y:{ grid:{display:false}, ticks:{color:'#1e365a',font:{family:OUTFIT}}, title:{display:true,text:'Kelompok Umur',color:'#1e365a',font:{family:OUTFIT,weight:800}} } }
      }
    });
  })();

  // Horizontal Bar: Distribusi Pendidikan
  (() => {
    const el = document.getElementById('eduBars'); if(!el) return;
    const ctx = el.getContext('2d');
    const g = ctx.createLinearGradient(0,0,800,0); g.addColorStop(0,'#FFB8A9'); g.addColorStop(1,'#FF7E6D');
    new Chart(ctx, {
      type:'bar',
      data:{ labels:["Tidak Sekolah","SD","SMP","SMA","Diploma","S1","S2","S3","Lainnya"], datasets:[{ label:'Jumlah Jiwa', data:[141,549,210,238,21,48,0,0,349], backgroundColor:g, borderRadius:8, borderSkipped:false }] },
      options:{
        indexAxis:'y', responsive:true, maintainAspectRatio:false, plugins:{ legend:{display:false},
          tooltip:{ backgroundColor:'#1e365a', titleFont:{family:OUTFIT,weight:'800'}, bodyFont:{family:OUTFIT,weight:'600'},
                    callbacks:{ title:c=>c[0].label, label:c=>` ${c.raw} jiwa` } } },
        scales:{ x:{ beginAtZero:true, grid:{color:'rgba(0,0,0,.06)'}, ticks:{color:'#1e365a',font:{family:OUTFIT}}, title:{display:true,text:'Jiwa',color:'#1e365a',font:{family:OUTFIT,weight:800}} },
                 y:{ grid:{display:false}, ticks:{color:'#1e365a',font:{family:OUTFIT}}, title:{display:true,text:'Tingkat Pendidikan',color:'#1e365a',font:{family:OUTFIT,weight:800}} } }
      }
    });
  })();

  // Data pekerjaan & sektor
  const RAW_JOBS = [
    {label:"Buruh Nelayan",value:158},{label:"Nelayan Pemilik Kapal",value:118},{label:"Lainnya",value:98},
    {label:"Petani Pemilik Lahan",value:9},{label:"Pedagang",value:7},{label:"Perangkat Desa",value:7},
    {label:"Buruh Tani",value:5},{label:"Nelayan Penyewa Perahu",value:4},{label:"PNS/ASN",value:4},
    {label:"Petani Penyewa",value:3},{label:"TNI",value:3},{label:"Guru Non PNS",value:2}
  ];
  const PERIKANAN=new Set(["Buruh Nelayan","Nelayan Pemilik Kapal","Nelayan Penyewa Perahu"]);
  const PERTANIAN=new Set(["Petani Pemilik Lahan","Petani Penyewa","Buruh Tani"]);
  const JASA=new Set(["Pedagang","Perangkat Desa","PNS/ASN","Guru Non PNS","TNI"]);
  const sectorOf = (n)=> PERIKANAN.has(n)?"Perikanan": PERTANIAN.has(n)?"Pertanian": JASA.has(n)?"Jasa & Profesional":"Lainnya";
  const sectorGradients = {
    "Perikanan":["#AFC3DD","#8DA6C6"],
    "Pertanian":["#FFB8A9","#FF7E6D"],
    "Jasa & Profesional":["#FFD5AD","#FFC48C"],
    "Lainnya":["#D6DEE5","#9BA7B4"]
  };
  const wrapLabel = (t,m=16)=> t.length<=m?t:((w=t.split(" ")),(l=w.shift(),w.forEach((x,i)=>{if((l+" "+x).length<=m)l+=" "+x;else w.splice(0,i+1)})), l+"\n"+w.join(" "));
  const JOBS = [...RAW_JOBS].sort((a,b)=>b.value-a.value);
  const jobLabels = JOBS.map(d=>wrapLabel(d.label));
  const jobValues = JOBS.map(d=>d.value);

  // Bar: Mata Pencaharian
  (() => {
    const el = document.getElementById('jobsBar'); if(!el) return;
    const ctx = el.getContext('2d');
    const makeGradient = (c,a,b)=>{const g=c.createLinearGradient(0,0,800,0); g.addColorStop(0,a); g.addColorStop(1,b); return g; };
    const jobColors = JOBS.map(d=>{ const [l,k] = sectorGradients[sectorOf(d.label)]||["#E6E6E6","#8A8A8A"]; return makeGradient(ctx,l,k); });

    const sectorLegend = {
      position:'bottom',
      labels:{ color:'#1e365a', usePointStyle:true, pointStyle:'rectRounded', boxWidth:12, padding:14,
        font:{family:OUTFIT,weight:800,size:13},
        generateLabels(){
          return Object.entries(sectorGradients).map(([name,[l,k]])=>({ text:name, fillStyle:makeGradient(ctx,l,k), strokeStyle:k, lineWidth:0, pointStyle:'rectRounded' }));
        }
      }, onClick:null
    };

    new Chart(ctx,{
      type:'bar',
      data:{ labels:jobLabels, datasets:[{ label:'Jumlah Jiwa', data:jobValues, backgroundColor:jobColors, borderWidth:0, borderRadius:8, barThickness:18 }] },
      options:{
        indexAxis:'y', responsive:true, maintainAspectRatio:false, layout:{padding:{right:28,left:6,top:6,bottom:8}},
        plugins:{ legend:sectorLegend, tooltip:{ backgroundColor:'#0f2030', titleFont:{family:OUTFIT,weight:'800'}, bodyFont:{family:OUTFIT,weight:'600'},
                  callbacks:{ label:(c)=>`${c.label.replaceAll('\n',' ')}: ${c.raw} jiwa` } } },
        scales:{ x:{ beginAtZero:true, grid:{color:'rgba(0,0,0,.06)'}, ticks:{color:'#1e365a',font:{family:OUTFIT,size:12}}, title:{display:true,text:'Jiwa',color:'#1e365a',font:{family:OUTFIT,weight:800,size:13}} },
                 y:{ grid:{display:false}, ticks:{color:'#1e365a',font:{family:OUTFIT,weight:800,size:12},autoSkip:false} } }
      }
    });
  })();

  // Legend statis donut sektor (pakai warna muda)
  const legendEl = document.getElementById('sectorLegend');
  if(legendEl){
    legendEl.innerHTML = Object.entries(sectorGradients).map(([n,[light]])=>`<span><i class="dot" style="background:${light};"></i>${n}</span>`).join('');
  }

  // Donut: Sektor total
  (() => {
    const dn = document.getElementById('sectorDonut'); if(!dn) return;
    const ctx = dn.getContext('2d');
    const makeGradient = (c,a,b)=>{const g=c.createLinearGradient(0,0,800,0); g.addColorStop(0,a); g.addColorStop(1,b); return g; };
    new Chart(ctx,{
      type:'doughnut',
      data:{ labels:['Perikanan','Pertanian','Jasa & Profesional','Lainnya'],
        datasets:[{ data:[280,17,121,98],
          backgroundColor:[
            makeGradient(ctx,'#AFC3DD','#8DA6C6'),
            makeGradient(ctx,'#FFB8A9','#FF7E6D'),
            makeGradient(ctx,'#FFD5AD','#FFC48C'),
            makeGradient(ctx,'#D6DEE5','#9BA7B4')
          ],
          borderWidth:0 }] },
      options:{ responsive:true, maintainAspectRatio:false, cutout:'68%', plugins:{ legend:{display:false}, tooltip:{ callbacks:{ label:c=>`${c.label}: ${c.raw} jiwa` } } } }
    });
    const el = document.getElementById('donutTotal'); if(el) el.textContent = (446).toLocaleString('id-ID');
  })();
});
</script>
</body>
</html>
